name: 自动更新版本

on:
  workflow_dispatch:
  push:
    branches:
      - main

jobs:
  bump-version:
    runs-on: ubuntu-latest
    permissions:
      contents: write
      pull-requests: write

    steps:
      # 检出代码
      - name: 检出代码
        uses: actions/checkout@v3

      # 自动更新版本号
      - name: 自动更新版本号
        id: bump_version
        uses: phips28/gh-action-bump-version@master
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        with:
          version-type: minor
          tag-prefix: "v"
          commit-message: "版本更新至 {{version}} 🎉"

      # 创建并推送新分支
      - name: 创建并推送新分支
        run: |
          git checkout -b version/v${{ steps.bump_version.outputs.new_version }}
          git push origin version/v${{ steps.bump_version.outputs.new_version }}

      # 创建 Pull Request
      - name: 创建 Pull Request
        uses: peter-evans/create-pull-request@v5
        with:
          token: ${{ secrets.GITHUB_TOKEN }}
          branch: version/v${{ steps.bump_version.outputs.new_version }} # 动态分支名
          title: "版本更新至 v${{ steps.bump_version.outputs.new_version }}"
          body: |
            此 PR 自动更新了版本至 `v${{ steps.bump_version.outputs.new_version }}` 🎉
          base: main
